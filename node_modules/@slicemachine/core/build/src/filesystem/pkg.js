"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addJsonPackageSmScript = exports.patchJsonPackage = exports.retrieveJsonPackage = void 0;
const paths_1 = require("./paths");
const utils_1 = require("../utils");
function retrieveJsonPackage(cwd) {
    const pkgPath = (0, paths_1.JsonPackagePath)(cwd);
    if (!utils_1.Files.exists(pkgPath)) {
        return {
            exists: false,
            content: null,
        };
    }
    const content = utils_1.Files.safeReadJson(pkgPath);
    return {
        exists: true,
        content,
    };
}
exports.retrieveJsonPackage = retrieveJsonPackage;
function patchJsonPackage(cwd, data) {
    const pkg = retrieveJsonPackage(cwd);
    if (!pkg.exists || !pkg.content)
        return false;
    const updatedPkg = {
        ...pkg.content,
        ...data,
    };
    utils_1.Files.write((0, paths_1.JsonPackagePath)(cwd), updatedPkg, { recursive: false });
    return true;
}
exports.patchJsonPackage = patchJsonPackage;
function addJsonPackageSmScript(cwd) {
    const pkg = retrieveJsonPackage(cwd);
    if (!pkg.exists || !pkg.content)
        return false;
    const { scripts = {} } = pkg.content;
    if (scripts[utils_1.CONSTS.SCRIPT_NAME])
        return false;
    return patchJsonPackage(cwd, {
        scripts: { ...scripts, [utils_1.CONSTS.SCRIPT_NAME]: utils_1.CONSTS.SCRIPT_VALUE },
    });
}
exports.addJsonPackageSmScript = addJsonPackageSmScript;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGtnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2ZpbGVzeXN0ZW0vcGtnLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUF1RDtBQUN2RCxvQ0FBeUM7QUFLekMsU0FBZ0IsbUJBQW1CLENBQUMsR0FBVztJQUM3QyxNQUFNLE9BQU8sR0FBRyxJQUFBLHVCQUFlLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFFckMsSUFBSSxDQUFDLGFBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDMUIsT0FBTztZQUNMLE1BQU0sRUFBRSxLQUFLO1lBQ2IsT0FBTyxFQUFFLElBQUk7U0FDZCxDQUFDO0tBQ0g7SUFFRCxNQUFNLE9BQU8sR0FBdUIsYUFBSyxDQUFDLFlBQVksQ0FDcEQsT0FBTyxDQUNjLENBQUM7SUFDeEIsT0FBTztRQUNMLE1BQU0sRUFBRSxJQUFJO1FBQ1osT0FBTztLQUNSLENBQUM7QUFDSixDQUFDO0FBakJELGtEQWlCQztBQUVELFNBQWdCLGdCQUFnQixDQUM5QixHQUFXLEVBQ1gsSUFBMEI7SUFFMUIsTUFBTSxHQUFHLEdBQTZCLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQy9ELElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU87UUFBRSxPQUFPLEtBQUssQ0FBQztJQUU5QyxNQUFNLFVBQVUsR0FBRztRQUNqQixHQUFHLEdBQUcsQ0FBQyxPQUFPO1FBQ2QsR0FBRyxJQUFJO0tBQ1IsQ0FBQztJQUVGLGFBQUssQ0FBQyxLQUFLLENBQUMsSUFBQSx1QkFBZSxFQUFDLEdBQUcsQ0FBQyxFQUFFLFVBQVUsRUFBRSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ3BFLE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQWRELDRDQWNDO0FBRUQsU0FBZ0Isc0JBQXNCLENBQUMsR0FBVztJQUNoRCxNQUFNLEdBQUcsR0FBRyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNyQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFFOUMsTUFBTSxFQUFFLE9BQU8sR0FBRyxFQUFFLEVBQUUsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDO0lBRXJDLElBQUksT0FBTyxDQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUM7UUFBRSxPQUFPLEtBQUssQ0FBQztJQUU5QyxPQUFPLGdCQUFnQixDQUFDLEdBQUcsRUFBRTtRQUMzQixPQUFPLEVBQUUsRUFBRSxHQUFHLE9BQU8sRUFBRSxDQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsRUFBRSxjQUFNLENBQUMsWUFBWSxFQUFFO0tBQ25FLENBQUMsQ0FBQztBQUNMLENBQUM7QUFYRCx3REFXQyJ9