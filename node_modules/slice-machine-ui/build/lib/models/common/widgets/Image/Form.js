"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.FormFields = void 0;
const yup = __importStar(require("yup"));
const react_1 = require("react");
const defaults_1 = require("@lib/forms/defaults");
const forms_1 = require("@lib/forms");
const Field_1 = __importDefault(require("@lib/builders/common/EditModal/Field"));
const formik_1 = require("formik");
const theme_ui_1 = require("theme-ui");
const Flex_1 = require("components/Flex");
const components_1 = require("./components");
const FormFields = {
    label: defaults_1.DefaultFields.label,
    id: defaults_1.DefaultFields.id,
};
exports.FormFields = FormFields;
const EMPTY_THUMBNAIL = {
    name: "",
    width: "",
    height: "",
};
const thumbText = ({ width, height } = {}, allowAuto) => {
    if (allowAuto && !width && !height) {
        return "auto";
    }
    if (width || height) {
        return `${width ? width : "auto"}x${height ? height : "auto"}`;
    }
    return "...";
};
const Form = (props) => {
    const [thumbI, setThumbI] = react_1.useState(0);
    const { initialValues, values: formValues, errors, fields, touched } = props;
    const { config: { thumbnails, constraint }, } = formValues;
    react_1.useEffect(() => {
        setThumbI(thumbnails.length);
    }, [thumbnails.length]);
    return (<Flex_1.Flex>
      {Object.entries(FormFields).map(([key, field]) => (<Flex_1.Col key={key}>
          <Field_1.default fieldName={forms_1.createFieldNameFromKey(key)} formField={field} fields={fields} initialValues={initialValues}/>
        </Flex_1.Col>))}
      <Flex_1.Col>
        <theme_ui_1.Label htmlFor="thumbnails" variant="label.primary" sx={{
            mt: 1,
            display: "flex",
            alignItems: "center",
        }}>
          Responsive views*
        </theme_ui_1.Label>
        <theme_ui_1.Card p={3}>
          <formik_1.FieldArray name="config.thumbnails" render={({ push, remove }) => (<react_1.Fragment>
                <theme_ui_1.Flex mb={3}>
                  <components_1.ThumbnailButton active={thumbI === 0} text={thumbText(constraint, true)} sx={{ mr: 2 }} onClick={() => setThumbI(0)}/>
                  {thumbnails.map((e, i) => (<components_1.ThumbnailButton key={`thumbnail-button-${+i + 1}`} sx={{ mr: 3 }} active={thumbI === +i + 1} text={thumbText(e)} error={errors.thumbnails &&
                    touched.thumbnails &&
                    touched.thumbnails[i] &&
                    errors.thumbnails &&
                    errors.thumbnails[i]} onDelete={() => remove(i)} onClick={() => setThumbI(+i + 1)}/>))}
                  <components_1.AddThumbnailButton onClick={() => {
                push(EMPTY_THUMBNAIL);
            }}/>
                </theme_ui_1.Flex>
                <components_1.ConstraintForm {...props} display={thumbI === 0} prefix="config.constraint"/>
                {thumbnails.map((_, i) => (<components_1.ConstraintForm {...props} required key={`thumbnail-${+i + 1}`} display={thumbI === +i + 1} prefix={`config.thumbnails[${i}]`}/>))}
              </react_1.Fragment>)}/>
        </theme_ui_1.Card>
      </Flex_1.Col>
    </Flex_1.Flex>);
};
FormFields.constraint = {
    validate: () => yup.object().defined().shape({
        width: yup.number().nullable(),
        height: yup.number().nullable(),
    }),
};
FormFields.thumbnails = {
    validate: () => yup
        .array()
        .defined()
        .of(yup.object().test({
        name: "Thumbnails",
        message: "Must set name and width or height at minimum",
        test: function (value) {
            if (!value.name) {
                return false;
            }
            if ((!value.width && !value.height) ||
                typeof value.width !== "number" ||
                typeof value.height !== "number") {
                return false;
            }
            return true;
        },
    })),
};
exports.default = Form;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRm9ybS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9tb2RlbHMvY29tbW9uL3dpZGdldHMvSW1hZ2UvRm9ybS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEseUNBQTJCO0FBQzNCLGlDQUFzRDtBQUV0RCxrREFBb0Q7QUFDcEQsc0NBQW9EO0FBRXBELGlGQUFtRTtBQUVuRSxtQ0FBb0M7QUFFcEMsdUNBQTZDO0FBQzdDLDBDQUF3RDtBQUN4RCw2Q0FJc0I7QUFFdEIsTUFBTSxVQUFVLEdBQUc7SUFFakIsS0FBSyxFQUFFLHdCQUFhLENBQUMsS0FBSztJQUUxQixFQUFFLEVBQUUsd0JBQWEsQ0FBQyxFQUFFO0NBQ3JCLENBQUM7QUEwS08sZ0NBQVU7QUF4S25CLE1BQU0sZUFBZSxHQUFHO0lBQ3RCLElBQUksRUFBRSxFQUFFO0lBQ1IsS0FBSyxFQUFFLEVBQUU7SUFDVCxNQUFNLEVBQUUsRUFBRTtDQUNYLENBQUM7QUFHRixNQUFNLFNBQVMsR0FBRyxDQUFDLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsRUFBRSxTQUFTLEVBQUUsRUFBRTtJQUN0RCxJQUFJLFNBQVMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLE1BQU0sRUFBRTtRQUNsQyxPQUFPLE1BQU0sQ0FBQztLQUNmO0lBQ0QsSUFBSSxLQUFLLElBQUksTUFBTSxFQUFFO1FBRW5CLE9BQU8sR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztLQUNoRTtJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQyxDQUFDO0FBRUYsTUFBTSxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBRTtJQUNyQixNQUFNLENBQUMsTUFBTSxFQUFFLFNB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