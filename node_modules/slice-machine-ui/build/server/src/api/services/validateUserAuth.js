"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateUserAuth = void 0;
const getPrismicData_1 = __importDefault(require("./getPrismicData"));
const DefaultClient_1 = __importDefault(require("@lib/models/common/http/DefaultClient"));
async function validateUserAuth() {
    const prismicData = getPrismicData_1.default();
    if (!prismicData.isOk()) {
        return {
            connected: false,
            reason: `Could not parse ~/.prismic file`,
        };
    }
    if (!prismicData.value.auth) {
        return {
            connected: false,
            reason: `Could not parse ~/.prismic prismic-auth string`,
        };
    }
    const res = await DefaultClient_1.default.validate(prismicData.value.base, prismicData.value.auth);
    if (res.status > 209) {
        return {
            connected: false,
            reason: `Could not authenticate you (base: ${prismicData.value.base})`,
        };
    }
    try {
        const body = await res.json();
        return {
            connected: true,
            reason: "",
            body,
        };
    }
    catch (e) {
        return {
            connected: false,
            reason: "Could not validate prismic-auth token.",
        };
    }
}
exports.validateUserAuth = validateUserAuth;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGVVc2VyQXV0aC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NlcnZlci9zcmMvYXBpL3NlcnZpY2VzL3ZhbGlkYXRlVXNlckF1dGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsc0VBQThDO0FBQzlDLDBGQUFrRTtBQUUzRCxLQUFLLFVBQVUsZ0JBQWdCO0lBQ3BDLE1BQU0sV0FBVyxHQUFHLHdCQUFjLEVBQUUsQ0FBQztJQUNyQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxFQUFFO1FBQ3ZCLE9BQU87WUFDTCxTQUFTLEVBQUUsS0FBSztZQUNoQixNQUFNLEVBQUUsaUNBQWlDO1NBQzFDLENBQUM7S0FDSDtJQUNELElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRTtRQUMzQixPQUFPO1lBQ0wsU0FBUyxFQUFFLEtBQUs7WUFDaEIsTUFBTSxFQUFFLGdEQUFnRDtTQUN6RCxDQUFDO0tBQ0g7SUFFRCxNQUFNLEdBQUcsR0FBRyxNQUFNLHVCQUFhLENBQUMsUUFBUSxDQUN0QyxXQUFXLENBQUMsS0FBSyxDQUFDLElBQUksRUFDdEIsV0FBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQ3ZCLENBQUM7SUFDRixJQUFJLEdBQUcsQ0FBQyxNQUFNLEdBQUcsR0FBRyxFQUFFO1FBQ3BCLE9BQU87WUFDTCxTQUFTLEVBQUUsS0FBSztZQUNoQixNQUFNLEVBQUUscUNBQXFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHO1NBQ3ZFLENBQUM7S0FDSDtJQUNELElBQUk7UUFFRixNQUFNLElBQUksR0FBRyxNQUFNLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUM5QixPQUFPO1lBQ0wsU0FBUyxFQUFFLElBQUk7WUFDZixNQUFNLEVBQUUsRUFBRTtZQUVWLElBQUk7U0FDTCxDQUFDO0tBQ0g7SUFBQyxPQUFPLENBQUMsRUFBRTtRQUNWLE9BQU87WUFDTCxTQUFTLEVBQUUsS0FBSztZQUNoQixNQUFNLEVBQUUsd0NBQXdDO1NBQ2pELENBQUM7S0FDSDtBQUNILENBQUM7QUF4Q0QsNENBd0NDIn0=