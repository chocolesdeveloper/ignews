"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.compare = void 0;
const core_1 = require("@slicemachine/core");
const files_1 = __importDefault(require("../../../../lib/utils/files"));
const paths_1 = require("../../../../lib/models/paths");
const versions_1 = require("./versions");
const versions_2 = require("./versions");
const DefaultComparison = {
    currentVersion: "",
    updateAvailable: false,
    latestNonBreakingVersion: null,
    packageManager: "npm",
    versions: [],
};
async function compare(cwd) {
    var _a;
    const pkg = core_1.FileSystem.retrieveJsonPackage(cwd);
    if (!pkg.exists || !((_a = pkg.content) === null || _a === void 0 ? void 0 : _a.name))
        return DefaultComparison;
    const currentVersion = pkg.content.version;
    const versions = await versions_2.findPackageVersions(pkg.content.name);
    const updateAvailable = versions_1.isUpdateAvailable(currentVersion, versions);
    const latestNonBreakingVersion = versions_1.findLatestNonBreakingUpdate(currentVersion, versions);
    const packageManager = files_1.default.exists(paths_1.YarnLock(cwd)) ? 'yarn' : 'npm';
    return {
        currentVersion,
        updateAvailable,
        latestNonBreakingVersion,
        packageManager,
        versions
    };
}
exports.compare = compare;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VtdmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc2VydmVyL3NyYy9hcGkvc2VydmljZXMvc2VtdmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDZDQUFnRDtBQUNoRCx3RUFBZ0Q7QUFDaEQsd0RBQXdEO0FBQ3hELHlDQUE0RTtBQUM1RSx5Q0FBaUQ7QUFHakQsTUFBTSxpQkFBaUIsR0FBZTtJQUNwQyxjQUFjLEVBQUUsRUFBRTtJQUNsQixlQUFlLEVBQUUsS0FBSztJQUN0Qix3QkFBd0IsRUFBRSxJQUFJO0lBQzlCLGNBQWMsRUFBRSxLQUFLO0lBQ3JCLFFBQVEsRUFBRSxFQUFFO0NBQ2IsQ0FBQztBQUVLLEtBQUssVUFBVSxPQUFPLENBQUMsR0FBVzs7SUFDdkMsTUFBTSxHQUFHLEdBQUcsaUJBQVUsQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNoRCxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUEsTUFBQSxHQUFHLENBQUMsT0FBTywwQ0FBRSxJQUFJLENBQUE7UUFBRSxPQUFPLGlCQUFpQixDQUFBO0lBRS9ELE1BQU0sY0FBYyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDO0lBQzNDLE1BQU0sUUFBUSxHQUFHLE1BQU0sOEJBQW1CLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3RCxNQUFNLGVBQWUsR0FBRyw0QkFBaUIsQ0FBQyxjQUFjLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDcEUsTUFBTSx3QkFBd0IsR0FBRyxzQ0FBMkIsQ0FBQyxjQUFjLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDdkYsTUFBTSxjQUFjLEdBQUcsZUFBSyxDQUFDLE1BQU0sQ0FBQyxnQkFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBRXBFLE9BQU87UUFDTCxjQUFjO1FBQ2QsZUFBZTtRQUNmLHdCQUF3QjtRQUN4QixjQUFjO1FBQ2QsUUFBUTtLQUNULENBQUE7QUFDSCxDQUFDO0FBakJELDBCQWlCQyJ9