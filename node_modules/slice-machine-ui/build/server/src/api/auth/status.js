"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const getAndSetUserProfile_1 = require("../services/getAndSetUserProfile");
const prismic_1 = require("@slicemachine/core/build/prismic");
async function handler(req) {
    try {
        const authToken = prismic_1.PrismicSharedConfigManager.getAuth();
        if (!Boolean(authToken)) {
            return { status: "pending" };
        }
        const profile = await getAndSetUserProfile_1.getAndSetUserProfile(req.env, authToken);
        return {
            status: "ok",
            shortId: profile.shortId,
            intercomHash: profile.intercomHash,
        };
    }
    catch (e) {
        console.error(e);
        return { status: "error" };
    }
}
exports.default = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc2VydmVyL3NyYy9hcGkvYXV0aC9zdGF0dXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFFQSwyRUFBd0U7QUFDeEUsOERBQThFO0FBRS9ELEtBQUssVUFBVSxPQUFPLENBQ25DLEdBQW1CO0lBRW5CLElBQUk7UUFDRixNQUFNLFNBQVMsR0FBRyxvQ0FBMEIsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN2RCxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFO1lBQ3ZCLE9BQU8sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLENBQUM7U0FDOUI7UUFFRCxNQUFNLE9BQU8sR0FBRyxNQUFNLDJDQUFvQixDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFFL0QsT0FBTztZQUNMLE1BQU0sRUFBRSxJQUFJO1lBQ1osT0FBTyxFQUFFLE9BQU8sQ0FBQyxPQUFPO1lBQ3hCLFlBQVksRUFBRSxPQUFPLENBQUMsWUFBWTtTQUNuQyxDQUFDO0tBQ0g7SUFBQyxPQUFPLENBQUMsRUFBRTtRQUNWLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakIsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsQ0FBQztLQUM1QjtBQUNILENBQUM7QUFwQkQsMEJBb0JDIn0=